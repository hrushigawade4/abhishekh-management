<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bhakt Management System</title>
    <!-- keep only one jspdf, then autotable -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.29/jspdf.plugin.autotable.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">
   <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <div id="app">
    <header class="header">
  <div class="container">
    <h1 class="logo">|| ‡§∂‡•ç‡§∞‡•Ä ‡§∏‡•ç‡§µ‡§æ‡§Æ‡•Ä ‡§∏‡§Æ‡§∞‡•ç‡§• ||</h1>

    <!-- Menu Toggle for Mobile -->
    <div class="menu-toggle" id="menu-toggle">
      <div></div>
      <div></div>
      <div></div>
    </div>

    <!-- Navigation -->
    <nav class="nav" id="nav">
      <button class="nav-btn active" data-page="dashboard">Dashboard</button>
      <button class="nav-btn" data-page="register">Register Bhakt</button>
      <button class="nav-btn" data-page="bhakts">Manage Bhakts</button>
      <button class="nav-btn" data-page="sacred-dates">Sacred Dates</button>
      <button class="nav-btn" data-page="scheduler">Monthly Scheduler</button>
      <button class="nav-btn" data-page="combined">Combined View</button>
      <button class="nav-btn" data-page="settings">Settings</button>
    </nav>
    <nav style="float:right;">
    <a href="{{ url_for('logout') }}" id="logout-btn">Logout</a>
  </nav>
  </div>
</header>

        <main class="main">
            <div class="container">
                <!-- Dashboard Page -->
                <div id="dashboard" class="page active">
                    <h2>Dashboard</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üë•</div>
                            <div class="stat-content">
                                <h3 id="total-bhakts">0</h3>
                                <p>Total Bhakts</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚ö°</div>
                            <div class="stat-content">
                                <h3 id="active-subscriptions">0</h3>
                                <p>Active Subscriptions</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìÖ</div>
                            <div class="stat-content">
                                <h3 id="sacred-dates-count">0</h3>
                                <p>Sacred Dates</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è∞</div>
                            <div class="stat-content">
                                <h3 id="expiring-soon">0</h3>
                                <p>Expiring Soon</p>
                            </div>
                        </div>
                    </div>
                   
                    <div class="recent-activity">
                        <h3>Recent Activity</h3>
                        <div id="recent-activity-list" class="activity-list"></div>
                    </div>
                    
                </div>

                <!-- Register Bhakt Page -->
                <div id="register" class="page">
                    <h2>Register New Bhakt</h2>
                    <form id="register-form" class="form">
                        <div class="form-group">
                        <label for="registration-number">Registration Number *</label>
                        <input type="text" id="registration-number" name="registration_number" required>
                        </div>
                        <div class="form-group">
                        <label for="name">Name *</label>
                        <input type="text" id="name" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="mobile">Mobile Number *</label>
                            <input type="tel" id="mobile" name="mobile" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" id="email" name="email">
                        </div>
                        <div class="form-group">
                            <label for="gotra">Gotra</label>
                            <input type="text" id="gotra" name="gotra">
                        </div>
                        <div class="form-group">
                            <label for="address">Address *</label>
                            <textarea id="address" name="address" required></textarea>
                        </div>
                       <div class="form-group">
                                    <label>Abhishek Types *</label>
                                    <div class="checkbox-group" id="abhishek-types">
                                        <!-- Checkboxes will be injected here by JS -->
                                    </div>
                                </div>
                            <div class="form-row">
                            <div class="form-group">
                                <label for="start-date">Start Date *</label>
                                <input type="date" id="start-date" name="start_date" required>
                            </div>
                            <div class="form-group">
                                <label for="validity">Validity (Months) *</label>
                                <select id="validity" name="validity_months" required>
                                    <option value="">Select validity</option>
                                    <option value="1">1 Month</option>
                                    <option value="3">3 Months</option>
                                    <option value="6">6 Months</option>
                                    <option value="12">12 Months</option>
                                    <option value="24">24 Months</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">Register Bhakt</button>
                    </form>
                </div>

                <!-- Manage Bhakts Page -->
                <div id="bhakts" class="page">
                    <div class="page-header">
                        <h2>Manage Bhakts</h2>
                        <div class="search-box">
                            <input type="text" id="bhakt-search" placeholder="Search bhakts...">
                        </div>
                    </div>
                   
                    <button id="show-expired-bhakts" class="btn btn-outline">Show Bhakts Seva Expired Last Month</button>
                    <button id="show-expiring-soon-bhakts" class="btn btn-outline">Show Bhakts Seva Expiring Soon</button>
                     <button id="export-bhakts" class="btn btn-outline">Export Bhakt List</button>
                    <div class="table-container">
                        <table id="bhakts-table" class="data-table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Mobile</th>
                                    <th>Gotra</th>
                                    <th>Abhishek Types</th>
                                    <th>Expiration</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="bhakts-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Sacred Dates Page -->
                <div id="sacred-dates" class="page">
                    <div class="page-header">
                        <h2>Sacred Dates Management</h2>
                        <button id="add-sacred-date-btn" class="btn btn-primary">Add Sacred Date</button>
                    </div>
                    <div class="table-container">
                        <table id="sacred-dates-table" class="data-table">
                            <thead>
                                <tr>
                                    <th>Abhishek Type</th>
                                    <th>Date</th>
                                    <th>Day</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="sacred-dates-tbody"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Monthly Scheduler Page -->
             <div id="scheduler" class="page">
    <div class="page-header">
        <h2>Monthly Scheduler</h2>
        <div class="scheduler-controls">
            <!-- Step 1: Select month and year -->
            <label for="schedule-month" style="margin-right:8px;">Month:</label>
            <select id="schedule-month">
                <option value="1">January</option>
                <option value="2">February</option>
                <option value="3">March</option>
                <option value="4">April</option>
                <option value="5">May</option>
                <option value="6">June</option>
                <option value="7">July</option>
                <option value="8">August</option>
                <option value="9">September</option>
                <option value="10">October</option>
                <option value="11">November</option>
                <option value="12">December</option>
            </select>
            <label for="schedule-year" style="margin:0 8px;">Year:</label>
            <select id="schedule-year"></select>
            <button id="generate-schedule" class="btn btn-secondary" style="margin-left:8px;">Generate</button>
        </div>
        <div class="scheduler-controls" style="margin-top:16px;">
            <!-- Step 2: Select Abhishek Type and exporheat filtered CSV -->
            <label for="abhishek-type-filter" style="margin-right:8px;">Abhishek Type:</label>
            <select id="abhishek-type-filter">
                <option value="">Select Abhishek Type</option>
                <!-- Options will be injected by JS -->
            </select>
            <button id="export-filtered-csv" class="btn btn-outline" style="margin-left:8px;">Export Filtered CSV</button>
            <button id="export-pdf" class="btn btn-outline">Export Filtered PDF</button>
            <button id="export-csv" class="btn btn-outline">Export CSV</button>
           <button id="export-active-bhakts-pdf" class="btn btn-outline">Pournima All List</button>

        </div>
        <div class="scheduler-controls" style="margin-top:16px;">
            <!-- Other export options -->
             <label>
            <input type="checkbox" id="include-mobile" checked>
            Include Mobile Number
            </label>

            <label>
            <input type="checkbox" id="include-address" checked>
            Include Address
            </label>
            <button id="generate-labels-btn" class="btn btn-outline">Generate Labels</button>
            <button id="export-labels-pdf" class="btn btn-success" style="margin-left:8px;">Download Labels PDF</button>
            
        </div>
        
    </div>
    <div id="schedule-content" class="schedule-content"></div>
    <div id="label-print-container" class="label-print-container" style="margin-top:20px;"></div>
</div>

                <!-- Combined View Page -->
                <div id="combined" class="page">
                    <h2>Combined View - Bhakts & Sacred Dates</h2>
                     <div class="search-box">
        <input type="text" id="combined-search" placeholder="Search by name, mobile, gotra, abhishek type...">
    </div>
                    <div id="combined-content" class="combined-content"></div>
                </div>
            </div>
            <div id="settings" class="page">
                <div class="settings-wrapper">
                    <h2>Settings</h2>
                    <button id="backup-db" class="btn btn-outline">Backup Database</button>
                    <form id="restore-db-form" enctype="multipart/form-data" style="display:inline;">
                    <input type="file" id="restore-db-file" name="file" style="display:none;">
                    <button type="button" id="restore-db-btn" class="btn btn-outline">Restore Database</button>
                    </form>
                    <div style="margin-top:20px;">
                        <input type="email" id="backup-email" placeholder="Enter Gmail address" class="form-control" style="max-width:220px;">
                        <button id="send-db-backup" class="btn btn-outline">Send DB Backup to Gmail</button>
                    </div>
                    <p style="font-size:10px; color:#bbb; margin-top:20px; opacity:0.5;">
                        Admin access required for backup and restore.
                    </p>

            <!-- Change password form -->
            <hr style="margin:16px 0;">
            <h3>Change Password</h3>
            <form id="change-password-form" action="{{ url_for('change_password') }}" method="POST" style="max-width:400px;">
                <div class="form-group">
                    <label for="current-password">Current Password</label>
                    <input type="password" id="current-password" name="current_password" required>
                </div>
                <div class="form-group">
                    <label for="new-password">New Password</label>
                    <input type="password" id="new-password" name="new_password" required>
                </div>
                <div class="form-group">
                    <label for="confirm-password">Confirm New Password</label>
                    <input type="password" id="confirm-password" name="confirm_password" required>
                </div>
                <button type="submit" class="btn btn-primary">Change Password</button>
            </form>
            </div>
                </main>
            </div>


    

    <!-- Modal for editing -->
    <div id="edit-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3 id="modal-title">Edit</h3>
            <div id="modal-body"></div>
        </div>
    </div>

    <!-- Modal for sacred date form -->
<div id="sacred-date-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Add Sacred Date</h3>
        <form id="sacred-date-form" class="form">
            <div class="form-group">
                <label for="sacred-abhishek-type">Abhishek Type *</label>
                <select id="sacred-abhishek-type" name="abhishek_type" required>
                    <option value="">Select type</option>
                    <!-- Options will be injected by JS -->
                </select>
                <div style="margin-top:8px;">
                    <input type="text" id="new-abhishek-type" placeholder="Add new type (optional)">
                    <button type="button" id="add-new-abhishek-type" class="btn btn-secondary" style="margin-left:8px;">Add</button>
                </div>
            </div>
            <div class="form-group">
                <label for="sacred-date">Date *</label>
                <input type="date" id="sacred-date" name="date" required>
            </div>
            <button type="submit" class="btn btn-primary">Add Sacred Date</button>
        </form>
    </div>
</div>
<script type="module" src="{{ url_for('static', filename='main.js') }}"></script>
 <footer style="font-size:10px; color:#bbb; text-align:center; margin-top:30px; opacity:0.5;">
       &copy; {{ year }} | Made by Hrushi Sonake & Hrushi Gawade
    </footer>
<!--Header Script-->
<script>
  const menuToggle = document.getElementById('menu-toggle');
  const nav = document.getElementById('nav');

  // Open/close menu on toggle click
  menuToggle.addEventListener('click', (e) => {
    e.stopPropagation(); // Prevent body click from immediately closing
    nav.classList.toggle('active');
  });

  // Close menu when clicking outside
  document.addEventListener('click', (e) => {
    if (!nav.contains(e.target) && !menuToggle.contains(e.target)) {
      nav.classList.remove('active');
    }
  });

  // Close menu when clicking on any link inside it
  nav.querySelectorAll('button, a').forEach((item) => {
    item.addEventListener('click', () => {
      nav.classList.remove('active');
    });
  });
</script>

</body>
</html>